# 理解 Gas 机制

## 第一题 交易最大费用
- 在以太坊上，用户发起一笔交易 设置了GasLimit 为 10000, Max Fee 为 10 GWei, Max priority fee 为 1 GWei ，为此用户应该在钱包账号里多少 GWei 的余额？
- 在以太坊上发起交易时，用户需要支付的最大费用是由 GasLimit、Max Fee 和 Max Priority Fee 这三个参数决定的。这笔费用是预先从用户的钱包中扣除的，以确保交易可以被网络处理。我们可以使用以下公式来计算用户钱包中应有的最小 GWei 余额：
- Max Fee = GasLimit * MaxFee  = 10000 * 10 GWei  = 100000 GWei 
- 因此，用户钱包中至少需要有 100000 GWei 的余额来支付这笔交易的最大费用。请注意，实际上可能会消耗较少的费用，因为 Max Fee 包括了 Base Fee 和 Priority Fee，而实际消耗的 Base Fee 可能低于 Max Fee。未使用的费用部分将会退还给用户。

## 第二题 验证者获得手续费
- 在以太坊上，用户发起一笔交易 设置了 GasLimit 为 10000, Max Fee 为 10 GWei, Max priority Fee 为 1 GWei，在打包时，Base Fee 为 5 GWei, 实际消耗的Gas为 5000， 那么矿工（验证者）拿到的手续费是多少 GWei ?
- 在以太坊上，矿工（验证者）获得的手续费是由 Priority Fee 和实际消耗的 Gas 数量决定的。我们可以使用以下公式来计算矿工拿到的手续费：
- 矿工手续费 = 实际消耗的Gas * MaxPriorityFee  = 5000 * 1 GWei  = 5000 GWei 
- 因此，矿工（验证者）从这笔交易中获得的手续费是 5000 GWei。请注意，这是因为实际消耗的 Gas 是5000，而用户设置的 Max Priority Fee 是1 GWei。

## 第三题 用户支付手续费
- 在以太坊上，用户发起一笔交易 设置了 GasLimit 为 10000, Max Fee 为 10 GWei, Max priority Fee 为 1 GWei，在打包时，Base Fee 为 5 GWei, 实际消耗的Gas为 5000， 那么用户需要支付的的手续费是多少 GWei ?
- 在以太坊上，用户实际需要支付的手续费是由 Base Fee、Priority Fee 和实际消耗的 Gas 数量决定的。我们可以使用以下公式来计算用户需要支付的手续费：
- 用户手续费 = (BaseFee + MaxPriorityFee) * 实际消耗的Gas  = (5 GWei + 1 GWei) * 5000  = 6 GWei * 5000  = 30000 GWei 
- Fee 是5 GWei，而用户设置的 Max Priority Fee 是1 GWei。如果 Max Fee 大于 Base Fee 加上 Priority Fee 的总和，那么超出的部分将会退还给用户。

## 第四题 燃烧掉的手续费
- 在以太坊上，用户发起一笔交易 设置了 GasLimit 为 10000, Max Fee 为 10 GWei, Max priority Fee 为 1 GWei，在打包时，Base Fee 为 5 GWei, 实际消耗的 Gas 为 5000， 那么燃烧掉的 Eth 数量是多少 GWei ?
- 在以太坊上，燃烧掉的 ETH 数量是由 Base Fee 和实际消耗的 Gas 数量决定的。燃烧掉的 ETH 是网络收取的 Base Fee 乘以实际消耗的 Gas 数量。我们可以使用以下公式来计算燃烧掉的 ETH 数量：
- 燃烧的 ETH = BaseFee * 实际消耗的Gas = 5 GWei * 5000  = 25000 GWei 
- 因此，燃烧掉的 ETH 数量是 25000 GWei。这部分 ETH 会从交易中被永久移除，不会进入矿工（验证者）的账户。


# 课程纪要

## 以太坊区块链与比特币的对比
主要讲述了以太坊的一些概念，包括区块链的价值、非对称加密、哈希等方式以及区块的生成和运行。同时，也提到了比特币的特点和局限性，以及以太坊在区块链中的地位。会议还介绍了以太坊的代码运行方式，需要一个虚拟机来解析字节码，从而实现代码的执行。

## 以太坊智能合约的运行与应用
主要介绍了以太坊的各种概念，包括智能合约、状态机等。智能合约是一种在区块链上运行的程序，可以独立运行，不受干扰。以太坊上的合约包含了数据和状态，与传统的人工智能有很大差别。在Web3中，通过智能合约的方式，可以在多个节点上运行代码，实现分布式运行。

## Web3应用中的数据同步与处理
这段内容主要讲述了区块链应用中的数据管理问题。在区块链应用中，数据通常由后端数据库来管理，而现在这种方式与传统应用不同，所有数据都需要自己进行修改。同时，在交易过程中，需要等待一段时间才能得到结果，这使得交易速度较慢。为了解决这个问题，引入了钱包这一工具，用于管理私钥，使得用户可以更方便地管理自己的资产。

## 智能合约与合约程序的概述
主要讲述了智能合约的架构和实现方式。智能合约是一种专门为合约或EVM设计的语言，类似于定义一个类，这个类中的变量就是合约里的数据，这些数据会存在于所有参与网络的节点的机器中。代码本身也会存在，这些代码会存在于所有的分布式节点中。智能合约的语法非常简单，声明用哪个版本编辑器，变量是强类型的，每个变量都要注明类型。合约还包含事件和错误处理等内容。此外，还介绍了以太坊上的账户概念，分为外部账户和合约账户。外部账户需要拿到私钥签名才能控制，而合约账户的状态修改是通过代码控制的。

## 以太坊账户结构及其状态变化
主要讨论了合约账户和状态根的概念。合约账户是自动运行的，通过代码控制，没有代码的账户是空的。在以太坊中，有很多账户，它们会组成一个全局的账户。每个账户内部也有其状态，由其内部的变量组成。合约账户和EOA账户在数据和状态上有所不同，但都会形成一个根。区块打包时，会将所有状态的账户映射成一个根，当数据发生变化时，会形成新的区块。

## 区块链账户与合约的使用与交互
主要讲述了合约在区块链上的应用。合约与普通账户一样，没有区别，所有的数据都在链上验证。钱包是私钥签名的工具，可以修改。不同的链有不同的实现方式，如比特币需要签名，以太坊不需要。合约只能被动执行，只有私钥的管理者才能主动触发一笔交易。手续费由外部账号支付，合约之间可以相互调用。有些服务会自动执行一些周期性任务，如邀请其他节点进行操作。

## 区块链交易与合约执行的规则解析
主要讲述了以太坊交易和合约的概念。以太坊上有三种不同的交易：普通转账、创建合约和EVMVM。普通转账和比特币的交易本质上是一样的，只是数据上有所不同。创建合约需要完整的字节码和地址，而EVMVM则可以执行Java字节码，并利用虚拟机进行代码执行。与传统编程环境相比，以太坊的执行方式有所不同。

## 以太坊共识与虚拟机运行的解析
主要讨论了以太坊的共识机制和EVM。以太坊的共识机制依赖于外部交易的触发和原有数据的获取，以确保所有节点都能获得完全一样的数据。同时，EVM依赖的数据来自于外部交易和原有数据。在以太坊上运行的程序可以在其他链上运行，但需要修改依赖的地址。此外，以太坊客户端还包含了一个EVM，可以实现共识功能。

## 土耳其伊斯坦布与以太坊网络升级
这段内容主要讲述了土耳其伊斯坦布尔的君士坦丁堡，以及POW公司和POS公司的网络升级。采访者提到，网络升级时会更新软件，包括EBM的软件。采访者还提到了一些不完善的升级历程，但目前还在进行中。此外，采访者强调了参与开源项目的重要性，以及如何通过节点服务商运行客户端。最后，采访者提到，以太坊上有很多客户端，可以组合使用，只要实现了EVM，就可以自己编写客户端程序。

## 硬件与钱包的概念及其应用
主要讲述了硬件和钱包的概念。硬件方面，虽然硬盘较为便携，但台式机和笔记本的硬盘价格不同。钱包是一个管理数据池私钥等工具，数据并不在钱包里，而是在链上。在发起交易时，需要用私钥进行签名确认。此外，还提到了一个名为Mask的浏览器插件，可以帮助快速跳过某些机制。最后，提到了EVM的计价方式，即在执行指令时会消耗一定的gas。

## 智能合约执行中的gas消耗与优化
这段内容主要讲述了在智能合约执行过程中，如何通过消耗Gas来控制运算量。首先，会指定一个Gas Limit，这个限制会根据程序复杂度决定。然后，会根据Gas Price来支付以太币给矿工。在执行指令时，会从Gas Limit和Gas Price中扣除所需的Gas。如果运算量过大，会抛出错误Out of Gas。此外，还提到了以太坊升级后的新机制，包括Base C和Tips两个部分，其中Base C会支付给矿工，而Tips则会被燃烧掉。

## 比特币交易费用与优先级设置
主要讨论了矿工费用、区块G limit、优先级费用和最大基础费用的相关问题。首先，矿工拿走一部分tips和guess的沉积，另外一部分base会被燃烧掉。区块G limit是用户指定最多愿意付出的优先级的费用和最多要支付的总费用，超过上限后，费用会根据网络应用情况进行波动。最后，设置了最大基础费用的钱包，可以根据当前网络情况设置默认值。

## 区块链程序开发与信任建立策略
主要讲述了在区块链开发中，如何减少用户猜测的使用量，提高程序的可读性和可维护性。同时，强调了审计的重要性，如何在保持区块链透明的同时，避免混淆。此外，还讨论了交易排序的问题，包括gas limit、交易费用等。最后，提到了Tips fee对交易排序的影响，以及如何通过分析来优化程序。

## 区块链应用操作与问题解答
这段内容主要讲述了关于区块链交易的一些基础知识，包括用户余额、单位填机位、支付手续费等。同时，介绍了如何查看交易手续费、优先级等信息。此外，还提到了开源的重要性，以及如何通过Mix ID进行部署。最后，讲者建议在编写程序时遵循源代码，并使用Suffering插件进行验证。

## 合约编写与部署的详细指南
主要介绍了合约编写、部署和测试的过程。首先，用户可以浏览文件并选择编译器。然后，将代码编译成字节码，并将其部署到区块链上。在部署过程中，会生成API，方便其他人调用合约。此外，还提供了虚拟环境进行测试和验证。最后，用户可以关联插件，从页面中读取数据。整个过程涉及多个功能按钮，如编译器、API、虚拟环境等。

## 区块链网络部署与测试的流程解析
主要讲述了关于测试网的使用和部署。首先，测试网与正常组网逻辑相同，会扣取手续费。在部署到测试网上时，需要等待签名。同时，会议还提到了链上的交易和调用合约的方法。此外，还介绍了不同的网络，如本地模拟网络、测试网（如hello）等，并强调了保持私钥安全的重要性。最后，提到了EVM兼容链的众多选择，可以选择一个易于获取的测试网络进行测试。

## 深入理解客户端账号与钱包签名概念
主要介绍了客户端、账号、钱包签名等概念，并分享了一些实际操作经验。会议还提到了部署合约的方法，如部署counter合约，并添加一个方法。通过实际操作，让大家更好地理解这些概念。此外，会议还鼓励大家去体验转账功能，以及部署和添加其他合约。作业内容相对简单，大约两分钟就能完成。希望大家在完成作业后，能够运用所学知识，感受这些概念。